<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../../css/index.css">
    <style>
        /* styles.css */
        #blurOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7); /* semi-transparent background */
            backdrop-filter: blur(10px); /* blur effect */
            display: none; /* initially hidden */
            z-index: 9999; /* ensures it's on top of other elements */
        }

        #userDetailsForm {
            margin-top: 20px;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: none; /* initially hidden */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10001; /* ensure it's above overlay */
        }

        #userDetailsForm label {
            display: block;
            margin-bottom: 5px;
        }

        #userDetailsForm input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #userDetailsForm button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            float: right;
        }

        #userDetailsForm button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <!-- Lightweight client-side loader that feature-detects and load polyfills only when necessary -->
    <script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2/webcomponents-loader.min.js"></script>

    <!-- Load the element definition -->
    <script type="module" src="https://cdn.jsdelivr.net/gh/zerodevx/zero-md@1/src/zero-md.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            validateCookie();
        });

        function validateCookie() {
            fetch('http://localhost:5000/v1/blog/cookie/validate', {
                method: "POST", // *GET, POST, PUT, DELETE, etc.
    mode: "cors", // no-cors, *cors, same-origin
    cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
    credentials: "same-origin", // include, *same-origin, omit
    headers: {
      "Content-Type": "application/json",
      // 'Content-Type': 'application/x-www-form-urlencoded',
    },
    redirect: "follow", // manual, *follow, error
    referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Invalid cookie');
                }
                return response.text();
            })
            .then(data => {
                showStatusMessage('Cookie is valid');
                removeBlur(); // Cookie is valid, remove blur overlay
            })
            .catch(error => {
                showStatusMessage(error.message);
                displayUserDetailsForm(); // Cookie is invalid or missing, show user details form
            });
        }

        function showStatusMessage(message) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
        }

        function displayUserDetailsForm() {
            document.getElementById('userDetailsForm').style.display = 'block';
        }

        function submitUserDetails(event) {
            event.preventDefault();

            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const courseName = document.getElementById('courseName').value; // Added courseName field
            const semester = document.getElementById('semester').value; // Added semester field

            // Example of sending user details to the server
            fetch('http://localhost:5000/v1/blog/cookie', {
                method: 'POST',
                credentials: 'same-origin',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ firstName, lastName, courseName, semester }) // Include courseName and semester
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to submit user details');
                }
                return response.text();
            })
            .then(data => {
                alert('User details submitted successfully!');
                document.getElementById('userDetailsForm').reset(); // Reset the form after successful submission
                removeBlur(); // After successful submission, remove any blur or restrictions
            })
            .catch(error => {
                showStatusMessage(error.message);
            });
        }

        function removeBlur() {
            document.getElementById('blurOverlay').style.display = 'none';
        }
    </script>

    <div id="blurOverlay"></div>

    <div class="column content">
        <!-- Simply set the `src` attribute to your MD file and win -->
        <zero-md src="../../../md/ref/linux/git.md"></zero-md>
    </div>
    
    <!-- User details form -->
    <form id="userDetailsForm" onsubmit="submitUserDetails(event)">
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" name="firstName" required><br>
        <label for="lastName">Last Name:</label>
        <input type="text" id="lastName" name="lastName" required><br>
        <label for="courseName">Course Name:</label> <!-- Added courseName field -->
        <input type="text" id="courseName" name="courseName" required><br>
        <label for="semester">Semester:</label> <!-- Added semester field -->
        <input type="text" id="semester" name="semester" required><br>
        <button type="submit">Submit</button>
    </form>

</body>
</html>
